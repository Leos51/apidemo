name: API CI/CD Workflow

on: [push]

env:
  JAVA_VERSION: '21'

jobs:
  build-and-test:
    name: Build & Test
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout code
        uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6

      - name: â˜• Set up JDK 21
        uses: actions/setup-java@be666c2fcd27ec809703dec50e508c2fdc7f6654 # v5
        with:
          distribution: 'temurin' # See 'Supported distributions' for available options
          java-version: ${{ env.JAVA_VERSION }}

      - name: ðŸ”¨ Build with Maven
        run: mvn clean compile

      - name: ðŸ§ª Run Tests
        run: mvn test

      - name: ðŸ“¦ Package Application
        run: mvn package -DskipTests

      - name: ðŸ“Š Test Report
        uses: dorny/test-reporter@d61b558e8df85cb60d09ca3e5b09653b4477cea7 # v1
        if: ${{ !cancelled() }}       # run this step even if previous step failed
        with:
          name: Maven Tests
          path: target/surefire-reports/*.xml
          reporter: java-junit
          fail-on-error: true

      - name: ðŸ“¤ Upload JAR artifact
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02 # v4
        with:
          name: api-jar
          path: target/*.jar
          retention-days: 5

      - name: ðŸ“ˆ Upload Test Results
        if: always()
        uses: actions/upload-artifact@ea165f8d65b6e75b540449e92b4886f43607fa02 # v4
        with:
          name: test-results
          path: target/surefire-reports/
          retention-days: 5


  deploy:
    name: ðŸš€ Deploy
    runs-on: ubuntu-latest
    needs: [build-and-test]
    steps:
      - name: ðŸŽ‰ Deployment Ready
      - run: |
          echo "========================================="
          echo "ðŸŽ‰ API ready for deployment!"
          echo "========================================="
